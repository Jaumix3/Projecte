<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carret de compra</title>
    <link rel="stylesheet" href="../css/carret.css">
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/carrito.js"></script>
</head>

<body>
    <header>
        <a href="../index.html">
            <img src="../assets/img/logo.png" alt="Logo JJ'S Sound Systems">
        </a>
        <input type="search" placeholder="Cerca...">
        <div class="icons">
            <a href="./carret.html">ðŸ›’</a>
        </div>
    </header>

    <main>
        <h1>Carret de compra</h1>

        <section class="carret-llista" id="carritoLista">
            <!-- Los artÃ­culos del carrito se cargarÃ¡n aquÃ­ dinamicamente -->
        </section>

        <section class="total">
            <h2>Total: <span id="totalPrecio">0,00â‚¬</span></h2>
            <button onclick="limpiarCarrito()">Buidar carrito</button>
            <button onclick="finalizarCompra()">Finalitzar compra</button>
        </section>
    </main>

    <footer>
        <a href="./formulari.html">Sobre nosaltres Â·</a> 
        <a href="./formulari.html">Contacte Â·</a>
        <a href="./formulari.html">PolÃ­tica de privacitat</a>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="../js/firebase-config.js"></script>
    <script src="../js/account-menu.js"></script>

    <script>
        // Mostrar carrito al cargar la pÃ¡gina
        function mostrarCarrito() {
            const items = carrito.obtener();
            const contenedor = document.getElementById('carritoLista');
            const totalPrecio = document.getElementById('totalPrecio');

            contenedor.innerHTML = '';

            if (items.length === 0) {
                contenedor.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">El carrito estÃ¡ vacÃ­o</p>';
                totalPrecio.textContent = '0,00â‚¬';
                return;
            }

            items.forEach(item => {
                const articulo = document.createElement('article');
                articulo.innerHTML = `
                    <img src="${item.imagen}" alt="${item.nombre}">
                    <div>
                        <h3>${item.nombre}</h3>
                        <p>Preu: ${item.precio.toFixed(2)}â‚¬</p>
                        <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                            <label for="cantidad-${item.id}">Quantitat:</label>
                            <input type="number" id="cantidad-${item.id}" value="${item.cantidad}" min="1" 
                                   onchange="actualizarCantidad('${item.id}', this.value)" 
                                   style="width: 60px; padding: 6px; border: 2px solid #e0e0e0; border-radius: 6px;">
                            <span>Subtotal: ${(item.precio * item.cantidad).toFixed(2)}â‚¬</span>
                            <button onclick="eliminarDelCarrito('${item.id}')" 
                                    style="background: #ef4444; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                Eliminar
                            </button>
                        </div>
                    </div>
                `;
                contenedor.appendChild(articulo);
            });

            totalPrecio.textContent = carrito.total() + 'â‚¬';
        }

        // Actualizar cantidad de un producto
        function actualizarCantidad(id, cantidad) {
            cantidad = parseInt(cantidad);
            if (cantidad > 0) {
                carrito.actualizar(id, cantidad);
                mostrarCarrito();
            } else {
                alert('La cantidad debe ser mayor que 0');
            }
        }

        // Eliminar producto del carrito
        function eliminarDelCarrito(id) {
            carrito.eliminar(id);
            mostrarCarrito();
        }

        // Limpiar todo el carrito
        function limpiarCarrito() {
            if (confirm('Â¿EstÃ¡s seguro de que quieres vaciar el carrito?')) {
                carrito.limpiar();
                mostrarCarrito();
            }
        }

        // Finalizar compra
        function finalizarCompra() {
            if (carrito.obtener().length === 0) {
                alert('El carrito estÃ¡ vacÃ­o');
                return;
            }
            alert('Â¡Compra realizada! Gracias por tu compra.');
            carrito.limpiar();
            mostrarCarrito();
        }

        // Mostrar carrito al cargar
        document.addEventListener('DOMContentLoaded', mostrarCarrito);
    </script>
</body>
</html>
